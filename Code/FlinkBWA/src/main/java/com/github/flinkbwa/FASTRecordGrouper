package com.github.flinkbwa;

//import org.apache.spark.api.java.function.PairFunction;
import scala.Tuple2;

/**
 * Class that implements functionality of indexing FASTQ input lines into groups of 4 (one read)
 */
public class FASTQRecordGrouper implements PairFunction<Tuple2<String, Long>, Long, Tuple2<String, Long>> {

    @Override
    public Tuple2<Long, Tuple2<String, Long>> call(Tuple2<String, Long> recordTuple) throws Exception {

        // We get string input and line number
        String line = recordTuple._1();
        Long fastqLineNum = recordTuple._2();

        // We obtain the record number from the line number
        Long recordNum = (long) Math.floor(fastqLineNum / 4);
        // We form the pair <String line, Long index inside record (0..3)>
        Tuple2<String, Long> newRecordTuple = new Tuple2<String, Long>(line, fastqLineNum % 4);

        // We return the data to group <Long record number,<String line, Long line index>>
        return new Tuple2<Long,Tuple2<String, Long>>(recordNum, newRecordTuple);
    }
}